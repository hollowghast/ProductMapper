<!DOCTYPE HTML>
<html>
<head>
    <title>Getting Started: Serving Web Content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- including Bootstrap lib -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

    <!-- including leaflet lib -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
    let map = undefined;
    let map_active_marker = undefined;

        function injectBootstrap(){
        Array.from(document.getElementsByTagName('ul'))
            .forEach(ul => ul.classList.add("list-group"));
        Array.from(document.getElementsByTagName('li'))
            .forEach(li => li.classList.add("list-group-item"));
    }

        function loadMap(){
            map = L.map('map').setView([47.07, 15.44], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
  maxZoom: 18,
}).addTo(map);
        }

        function showAddresses() {
            let list = fetch('/address/all')
                .then(response => response.json())
                .then(data => {
                    let html = '<ul>';
                    data.forEach(item => {
                        html += `<li>${item.zipcode}</li>`;
                        html += `<li>${item.city}</li>`;
                        html += `<li>${item.street}</li>`;
                        html += "<hr>";
                    });
                    html += '</ul>';
                    document.getElementById('view_allAddresses').innerHTML = html;
                    injectBootstrap();
                });
        }

function setMarker(){
    let address = 'Griesplatz 1, 8020 Graz';

fetch('https://nominatim.openstreetmap.org/search/' + encodeURIComponent(address) + '?format=json')
  .then(response => response.json())
  .then(data => {
    if (data.length > 0) {
      let lat = parseFloat(data[0].lat);
      let lon = parseFloat(data[0].lon);

      // Create a marker at the coordinates
      if(map_active_marker != undefined) map.removeLayer(map_active_marker);
      map_active_marker = L.marker([lat, lon]);
      map_active_marker.addTo(map);
      // Set the map view to the marker location
      map.setView([lat, lon], 13);
    } else {
      console.log('No results found for the address');
    }
  })
  .catch(error => {
    console.error('Error:', error);
  });
}

window.addEventListener('load',
        function(){
            loadMap();
        }
    );
    /*document.addEventListener('DOMContentLoaded',
        function(){
            injectBootstrap();
        }
    );
    window.addEventListener('load',
        function(){
            injectBootstrap();
        }
    );*/

    </script>
</head>
<body>

<div class="nav nav-tabs mb-3">
    <button class="nav-link active" id="nav-greeting-tab" data-bs-toggle="tab"
            data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
            aria-selected="true">
        Get your greeting <a href="/hello">here</a>
    </button>
    <button class="nav-link" type="button" role="tab" onclick="redirect://test.html" >
        test
    </button>
    <button class="nav-link" data-bs-toggle="tab"
            type="button" role="tab" onclick="showAddresses()" >
        Show all addresses in db
    </button>
</div>

<div id="map" style="height: 400px;"></div>
<div id="view_allAddresses"></div>

</body>
</html>